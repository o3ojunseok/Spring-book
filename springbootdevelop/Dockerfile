FROM eclipse-temurin:17 as builder

COPY gradlew .
COPY gradle gradle
COPY build.gradle .
COPY settings.gradle .
COPY src src


RUN chmod +x ./gradlew
RUN ./gradlew bootJar

FROM eclipse-temurin:11

ARG ARG_SPRING_DATASOURCE_URL
ARG ARG_SPRING_DATASOURCE_USERNAME
ARG ARG_SPRING_DATASOURCE_PASSWORD
ARG ARG_SPRING_DATASOURCE_DRIVER_CLASS_NAME
ARG ARG_SPRING_JPA_SHOW_SQL
ARG ARG_SPRING_JPA_HIBERNATE_DDL_AUTO

ENV SPRING_DATASOURCE_DRIVER_CLASS_NAME=${ARG_SPRING_DATASOURCE_DRIVER_CLASS_NAME}
ENV SPRING_DATASOURCE_URL=${ARG_SPRING_DATASOURCE_URL}
ENV SPRING_DATASOURCE_USERNAME=${ARG_SPRING_DATASOURCE_USERNAME}
ENV SPRING_DATASOURCE_PASSWORD=${ARG_SPRING_DATASOURCE_PASSWORD}
ENV SPRING_JPA_SHOW_SQL=${ARG_SPRING_JPA_SHOW_SQL}
ENV SPRING_JPA_HIBERNATE_DDL_AUTO=${ARG_SPRING_JPA_HIBERNATE_DDL_AUTO}

COPY --from=builder build/libs/*.jar app.jar

EXPOSE 8080

ENTRYPOINT ["java","-jar","/app.jar"]